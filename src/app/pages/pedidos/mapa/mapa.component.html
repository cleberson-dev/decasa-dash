<ngx-tabber [tabs]="tabs"></ngx-tabber>

<nb-card>
  <nb-card-body>
    <table>
      <colgroup>
        <col class="resizable" />
        <col class="produtos-col" />
        <col class="resizable" />
        <col class="resizable" />
        <col class="resizable" />
      </colgroup>
      <thead>
        <tr>
          <th colspan="4">Pedido (RFQ)</th>
          <th colspan="4" class="bordered">Fornecedores</th>
          <th></th>
        </tr>
        <tr>
          <th class="bordered">Código</th>
          <th class="bordered">Produtos</th>
          <th class="bordered">Un.</th>
          <th class="bordered">Qtd.</th>
          <th 
            *ngFor="let fornecedor of fornecedores; let i = index;"
            [class]="{ fornecedor: true, bordered: true, 'menor-fornecedor': i === menorSomaIdx }"
          >
            <nb-icon class="info" icon="info-outline"></nb-icon>
            {{ fornecedor }}
          </th>
          <th class="bordered">Últimas compras</th>
        </tr>
        <tr>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th 
            *ngFor="let somaFornecedor of somaFornecedores; let i = index;" 
            [class]="{ bordered: true, 'menor-fornecedor': i === menorSomaIdx }"
          >
            {{ somaFornecedor ? "Σ " + somaFornecedor.toFixed(2) : "--" }}
          </th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr
          (click)="openRowDetails(dialog, row)"
          *ngFor="let row of data; let i = index"
        >
          <td>{{ row.produto.codigo }}</td>
          <td>{{ row.produto.nome }}</td>
          <td>{{ row.produto.unidade }}</td>
          <td>{{ row.produto.quantidade }}</td>
          <td
            *ngFor="let preco of row.precos; let j = index"
            [class]="{ menor: j === row.menorPrecoIdx, preco: true, 'menor-fornecedor': j === menorSomaIdx }"
          >
            {{ preco || "--" }}
          </td>
          <td class="last-prices increase">
            <nb-icon class="icon" icon="arrow-up"></nb-icon>
            9.99 
          </td>
        </tr>
      </tbody>
      
    </table>
    <fieldset>
      <legend class="purple">Menor preço total</legend>
      <legend class="green">Menor preço do produto</legend>
    </fieldset>

    <button nbButton>Adicionar fornecedor</button>
    <nb-card-footer>
      <button nbButton status="primary">Próximo</button>
    </nb-card-footer>
  </nb-card-body>
</nb-card>

<ng-template #dialog let-produto let-ref="dialogRef">
  <nb-card>
    <nb-card-header>Detalhes do Produto</nb-card-header>
    <nb-card-body class="dialog-body">
      <div class="left">
        <h5>Código</h5>
        <p>{{ produto.codigo }}</p>
        <h5>Nome</h5>
        <p>{{ produto.nome }}</p>
        <h5>Unidade</h5>
        <p>{{ produto.unidade }}</p>
        <h5>Quantidade</h5>
        <p>{{ produto.quantidade }}</p>
      </div>
      <div class="right">
        <h5>Preços</h5>
      </div>
    </nb-card-body>
  </nb-card>
</ng-template>